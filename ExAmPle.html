<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MDWOCAO.js Demo</title>
    
    <!-- 1. KaTeX Dependency (Required for Math) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>

    <!-- 2. MDWOCAO Core Library -->
    <script src="mdwocao.js"></script>

    <style>
        /* Global Reset */
        body, html { margin: 0; padding: 0; height: 100%; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif; overflow: hidden; background: #fff; }
        
        /* Layout */
        .container { display: flex; height: 100vh; }
        
        .editor-pane, .preview-pane {
            flex: 1;
            height: 100%;
            overflow-y: hidden; /* Important for custom scroll handling */
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
        }

        .editor-pane {
            border-right: 1px solid #e1e4e8;
            background-color: #1e1e1e; /* Dark theme for editor */
        }

        /* Header Bar */
        .header {
            padding: 10px 20px;
            background: #2d2d2d;
            border-bottom: 1px solid #333;
            font-weight: 600;
            color: #ccc;
            font-size: 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .header span { opacity: 0.7; font-size: 12px; }

        /* Textarea styling */
        textarea {
            flex: 1;
            width: 100%;
            border: none;
            padding: 20px;
            resize: none;
            font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            outline: none;
            background: #1e1e1e;
            color: #d4d4d4;
            box-sizing: border-box;
            overflow-y: auto;
        }

        /* Preview Area */
        .preview-pane {
            padding: 0;
            background-color: #ffffff;
        }
        
        #preview {
            padding: 40px;
            overflow-y: auto;
            height: 100%;
            box-sizing: border-box;
        }

        /* --- Demo Custom Classes (Testing Attribute Parsing) --- */
        .demo-box {
            border: 2px solid #e1e4e8;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            transition: all 0.3s;
        }
        .demo-box:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .text-center { text-align: center; }
        .rainbow-text {
            background: linear-gradient(to right, #ef5350, #f48fb1, #7e57c2, #2196f3, #26c6da, #43a047, #fdd835, #f4511e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: bold;
        }
    </style>
</head>
<body>

<div class="container">
    <!-- Left: Editor -->
    <div class="editor-pane" id="editorWrapper">
        <div class="header">
            MARKDOWN INPUT
            <span>MDWOCAO.js V24</span>
        </div>
        <textarea id="editor" spellcheck="false">
# ðŸš€ MDWOCAO.js V24 Showcase

Welcome to the **Ultimate Demo**. This document demonstrates every single feature of the parser.

[TOC]

---

## 1. Typography & Formatting

**Bold Text**, *Italic Text*, ~~Strikethrough~~.
We also support ==Highlighted Text==, H~2~O (Subscript), and X^2^ (Superscript).

Keys: Press <kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>Esc</kbd> to explode properly.

---

## 2. GitHub Alerts (Callouts)

> [!NOTE] 
> **Standard Note**: Useful for general information.
> Supports multiline content.

> [!TIP] **Quick Tip**: You can use single-line syntax like this!

> [!WARNING]
> **Warning**: Watch out for edge cases.

> [!IMPORTANT]
> **Important**: This library is lightweight (< 10KB).

> [!CAUTION]
> **Caution**: Do not divide by zero.

---

## 3. Math Formulas (KaTeX)

**Inline Math**:
The mass-energy equivalence is described by $E=mc^2$.
Euler's identity: $e^{i\pi} + 1 = 0$.

**Block Math**:
A Gaussian Integral:
$$
\int_{-\infty}^{\infty} e^{-x^2} \,dx = \sqrt{\pi}
$$

A Complex Matrix:
$$
M = \begin{pmatrix}
a & b \\
c & d
\end{pmatrix}
$$

---

## 4. Code Blocks & Guarding

MDWOCAO protects content inside code blocks. **Math ($)** and **Emoji (::)** are ignored here.

### JavaScript (Line Numbers + Highlight)
```javascript {linenos=on hl_lines=[2,5]}
function calculatePrice(base) {
    // The $ sign here is NOT math
    const $taxRate = 0.08; 
    let emoji = ":smile:"; // This is NOT an emoji
    
    return base * (1 + $taxRate);
}
```

### Bash (No Highlight)
```bash
# Testing robustness
echo "Downloading... 100%"
export PATH=$PATH:/usr/bin
```

---

## 5. Custom Attributes (CSS & Classes)

We fixed the HEX color parsing bug! You can now use detailed styles.

### ðŸŽ¨ Custom Colored Box {.demo-box style="background-color: #f0f9ff; border-color: #bae7ff;"}
This div has a custom class `.demo-box` and inline styles with **HEX Colors** (`#f0f9ff`).
**ID Check**: This element should NOT have a weird ID.

### Gradient Text {.text-center .rainbow-text}
This is a centered header with a custom "rainbow-text" class.

---

## 6. Emojis

| Category | Icons |
| :--- | :--- |
| **Faces** | :smile: :joy: :sunglasses: :thinking: :sob: |
| **Hearts** | :heart: :blue_heart: :broken_heart: :purple_heart: |
| **Objects** | :rocket: :fire: :tada: :bomb: :100: |
| **Hands** | :+1: :-1: :pray: :muscle: :ok_hand: |

---

## 7. Lists & Complexity

### Nested Lists
1. First Item
2. Second Item
    - Sub-item A
    - Sub-item B with math: $x+y=z$
    - Sub-item C with emoji :star:
3. Third Item

### Task List
- [x] Implement Core Parser
- [x] Fix HEX Color Bug
- [x] Add Scroll Sync
- [ ] Take a break :coffee:

### Definition List
Markdown : A lightweight markup language.
MDWOCAO : A fast JS parser for Markdown.

---

## 8. Tables

| Name | Role | Power Level | Status |
| :--- | :---: | :---: | ---: |
| **Alice** | Admin | 9000+ | :check: |
| **Bob** | User | $10^2$ | :warning: |
| **Eve** | *Hacker* | $\infty$ | :x: |

---

## 9. Images & Links

This is a [Link to Google](https://google.com).

![Markdown Logo](https://markdown-here.com/img/icon256.png)

---

## 10. Footnotes

Here is a reference to a footnote[^1].
And another one[^2].

[^1]: Footnotes are placed at the bottom automatically.
[^2]: They support **formatting** too.
        </textarea>
    </div>

    <!-- Right: Preview -->
    <div class="preview-pane">
        <div id="preview"></div>
    </div>
</div>

<script>
    // --- Elements ---
    const editor = document.getElementById('editor');
    const previewArea = document.getElementById('preview');
    const editorWrapper = document.getElementById('editorWrapper');
    const previewWrapper = document.querySelector('.preview-pane');

    // --- Core Logic ---

    /**
     * Parse and Render Markdown
     */
    function render() {
        const text = editor.value;
        const startTime = performance.now();
        
        // Call MDWOCAO
        const html = MDWOCAO.parse(text);
        
        const endTime = performance.now();
        previewArea.innerHTML = html;
        
        // Optional: Log render time for performance check
        // console.log(`Rendered in ${(endTime - startTime).toFixed(2)}ms`);
    }

    // Initial Render
    render();

    // Real-time Update
    editor.addEventListener('input', render);


    // --- Scroll Synchronization (Fixed Version) ---
    
    let isScrolling = false;
    let activeSource = null; // 'editor' or 'preview'

    // Detect Mouse Enter to determine active scroll source
    // This prevents the "looping" scroll glitch
    editor.addEventListener('mouseenter', () => { activeSource = 'editor'; });
    previewArea.addEventListener('mouseenter', () => { activeSource = 'preview'; });

    // Sync: Editor -> Preview
    editor.addEventListener('scroll', (e) => {
        if (activeSource !== 'editor') return;

        // Calculate percentage
        const percentage = editor.scrollTop / (editor.scrollHeight - editor.clientHeight);
        
        // Map to preview
        // Note: previewArea is the scrollable div inside previewWrapper
        // But in CSS, #preview has overflow-y:auto? No, let's check CSS.
        // Wait, in CSS: .preview-pane has padding, #preview has overflow-y:auto.
        // Actually, let's map to #preview's scroll.
        
        const targetScroll = (previewArea.scrollHeight - previewArea.clientHeight) * percentage;
        previewArea.scrollTop = targetScroll;
    });

    // Sync: Preview -> Editor
    previewArea.addEventListener('scroll', (e) => {
        if (activeSource !== 'preview') return;

        const percentage = previewArea.scrollTop / (previewArea.scrollHeight - previewArea.clientHeight);
        const targetScroll = (editor.scrollHeight - editor.clientHeight) * percentage;
        
        editor.scrollTop = targetScroll;
    });

</script>
</body>
</html>
